<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>赚点-推荐有奖</title>
    <link rel="stylesheet" type="text/css" href="swiper.min.css" />

    <link rel="stylesheet" type="text/css" href="style.css" />
    <script>
      (function(doc, win) {
        var docEl = doc.documentElement,
          resizeEvt =
            "orientationchange" in window ? "orientationchange" : "resize",
          recalc = function() {
            var clientWidth = docEl.clientWidth;
            if (!clientWidth) return;
            if (clientWidth >= 640) {
              docEl.style.fontSize = "100px";
            } else {
              docEl.style.fontSize = 100 * (clientWidth / 640) + "px";
            }
          };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener("DOMContentLoaded", recalc, false);
      })(document, window);
    </script>
  </head>
  <body>
    <div class="h5-bg">
      <div class="h5-content">
        <div class="h5-title">
          <div class="h5-title-new">新人三轮抽奖福利</div>
          <div class="h5-title-bottom">
            目前还剩余
            <div class="num" id-"num"></div>
            次抽奖机会
          </div>
        </div>
        <div class="h5-main">
          <div class="h5-main-g1"></div>
          <div class="h5-main-g2"></div>
          <div class="h5-main-g3 "></div>
          <div class="h5-main-box-content">
            <div class="item" style="transform: rotate(0deg);">
              <div id="1"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(45deg);">
              <div id="2"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(90deg);">
              <div id="3"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(135deg);">
              <div id="4"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(180deg);">
              <div id="5"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(-135deg);">
              <div id="6"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(-90deg);">
              <div id="7"></div>
              <div></div>
            </div>
            <div class="item" style="transform: rotate(-45deg);">
              <div id="8"></div>
              <div></div>
            </div>
          </div>
          <div class="h5-main-zz"></div>
        </div>
        <div class="h5-more">
          获取更多抽奖机会
        </div>
      </div>
    </div>
  </body>
</html>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.rotate.min.js"></script>
<script>
 //大转盘奖品名称
  var restaraunts = [
    [8, "感觉10个字差不多了吧"],
    [10, "行不行"],
    [20, "这样子应该够了吧"],
    [10, "没问题"],
    [5, "可乐可乐可乐可乐可乐"],
    [8, "乐事"],
    [10, "雪碧"],
    [2, "美年达"]
  ]; 
  //false:停止;ture:旋转
  var rotateFlag = false; 
  //抽奖次数
  var num = 3; 
  //抽中的id
  var id = Math.floor(Math.random() * 7 + 1); 

  $(document).ready(function() {
    $('.num')[0].innerHTML=num;
    console.log($('.item'))
    $.each($('.item'), function (i, value) {
          console.log($(this));
          console.log(i);
          $(this)[0].innerHTML=`<div id=${i+1}>${restaraunts[i][0]}</div><div>${restaraunts[i][1]}</div>` ;
      });
    var rotateFn = function(item, txt) {
      var angles =
        item * (360 / restaraunts.length) - 360 / (restaraunts.length * 2);
      if (angles < 270) {
        angles = 270 - angles;
      } else {
        angles = 360 - angles + 270;
      }
      $(".h5-main-box-content").stopRotate();
      $('.h5-content').eq(0).addClass('h5-content-true');
      $('.h5-main-g1').eq(0).addClass('h5-main-g1-true');
      $('.h5-main-g2').eq(0).addClass('h5-main-g2-true');
      $('.h5-main-g3').eq(0).addClass('h5-main-g3-true');

      $(".h5-main-box-content").rotate({
        angle: 0,
        animateTo: angles + 1800 + 22.5,
        duration: 8000,
        callback: function() {
            $('.h5-content').eq(0).removeClass('h5-content-true');
            $('.h5-main-g1').eq(0).removeClass('h5-main-g1-true');
            $('.h5-main-g2').eq(0).removeClass('h5-main-g2-true');
            $('.h5-main-g3').eq(0).removeClass('h5-main-g3-true');
          alert(txt);
          rotateFlag = !rotateFlag;
        }
      });
    };

    $(".h5-main-zz").click(function() {
      if (!num) {
        alert("没有次数了");
        return;
      }
      if (rotateFlag) return;

      rotateFlag = !rotateFlag;
      num--;
      $('.num')[0].innerHTML = num;
      var item = id;
      rotateFn(item - 2, restaraunts[item - 1]);
    });

  });
</script>
